<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - M-PESEWA</title>
    <link rel="stylesheet" href="../../assets/css/main.css">
    <link rel="stylesheet" href="../../assets/css/components.css">
    <link rel="stylesheet" href="../../assets/css/dashboard.css">
    <link rel="manifest" href="../../manifest.json">
    <link rel="icon" href="../../assets/images/logo.svg" type="image/svg+xml">
    <meta name="theme-color" content="#061257">
    <style>
        .admin-dashboard {
            background: #f8f9fa;
        }
        
        .admin-warning {
            background: linear-gradient(135deg, #FF4401 0%, #FF9F1C 100%);
            color: white;
            padding: 15px 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 12px;
        }
        
        .admin-warning-icon {
            font-size: 24px;
        }
        
        .admin-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .admin-stat-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            border-left: 4px solid;
        }
        
        .admin-stat-card.critical {
            border-left-color: #FF4401;
        }
        
        .admin-stat-card.warning {
            border-left-color: #FF9F1C;
        }
        
        .admin-stat-card.success {
            border-left-color: #20BF6F;
        }
        
        .admin-stat-card.info {
            border-left-color: #0A65FC;
        }
        
        .admin-table-container {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            margin-bottom: 30px;
        }
        
        .admin-actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }
        
        .admin-action-card {
            background: white;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 2px 10px rgba(0,0,0,0.05);
            transition: transform 0.2s;
            cursor: pointer;
            border: 1px solid #E0E4EA;
        }
        
        .admin-action-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
        }
        
        .admin-action-icon {
            font-size: 32px;
            margin-bottom: 10px;
            display: block;
        }
        
        .override-badge {
            background: #FF4401;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 8px;
        }
        
        .access-level-badge {
            background: #061257;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
    </style>
</head>
<body class="admin-dashboard">
    <!-- Header -->
    <header class="dashboard-header">
        <div class="container">
            <div class="dashboard-brand">
                <a href="../../index.html" class="logo-link">
                    <div class="logo-icon">‚Çµ</div>
                    <span class="logo-text">M-PESEWA</span>
                    <span class="logo-subtitle">Admin Dashboard</span>
                </a>
                <span class="access-level-badge">PLATFORM ADMIN</span>
            </div>

            <div class="dashboard-user">
                <div class="user-info">
                    <div class="user-avatar">üëë</div>
                    <div class="user-details">
                        <span class="user-name" id="adminName">Platform Admin</span>
                        <span class="user-role">Super Administrator</span>
                    </div>
                </div>
                <div class="user-actions">
                    <button class="btn-icon" id="systemLogsBtn" title="System Logs">
                        <span class="icon">üìã</span>
                    </button>
                    <button class="btn-icon" id="auditTrailBtn" title="Audit Trail">
                        <span class="icon">üîç</span>
                    </button>
                    <button class="btn-icon" id="maintenanceBtn" title="Maintenance">
                        <span class="icon">üõ†Ô∏è</span>
                    </button>
                    <button class="btn btn-outline btn-small" id="logoutBtn">Logout</button>
                </div>
            </div>

            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </div>
    </header>

    <!-- Mobile Menu -->
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <div class="user-info">
                <div class="user-avatar">üëë</div>
                <div class="user-details">
                    <span class="user-name" id="mobileAdminName">Platform Admin</span>
                    <span class="user-role">Super Administrator</span>
                </div>
            </div>
            <button class="close-menu" id="closeMenuBtn">&times;</button>
        </div>
        <nav class="mobile-nav">
            <a href="./admin-dashboard.html" class="mobile-nav-link active">
                <span class="icon">üìä</span> Admin Dashboard
            </a>
            <a href="../../pages/blacklist.html" class="mobile-nav-link">
                <span class="icon">‚ö´</span> Blacklist Management
            </a>
            <a href="../../pages/ledger.html?admin=true" class="mobile-nav-link">
                <span class="icon">üìã</span> Ledger Overrides
            </a>
            <a href="../../pages/subscriptions.html?admin=true" class="mobile-nav-link">
                <span class="icon">üí≥</span> Subscription Management
            </a>
            <a href="../../pages/groups.html?admin=true" class="mobile-nav-link">
                <span class="icon">üë•</span> Group Moderation
            </a>
            <a href="../../pages/countries/index.html?admin=true" class="mobile-nav-link">
                <span class="icon">üåç</span> Country Management
            </a>
            <a href="../../pages/debt-collectors.html?admin=true" class="mobile-nav-link">
                <span class="icon">üíº</span> Collector Verification
            </a>
            <a href="../../pages/contact.html?admin=true" class="mobile-nav-link">
                <span class="icon">üìû</span> Support Tickets
            </a>
        </nav>
    </div>

    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="dashboard-sidebar">
            <nav class="sidebar-nav">
                <a href="./admin-dashboard.html" class="sidebar-link active">
                    <span class="sidebar-icon">üìä</span>
                    <span class="sidebar-text">Admin Dashboard</span>
                </a>
                <a href="../../pages/blacklist.html" class="sidebar-link">
                    <span class="sidebar-icon">‚ö´</span>
                    <span class="sidebar-text">Blacklist Management</span>
                    <span class="sidebar-badge" id="pendingBlacklist">0</span>
                </a>
                <a href="../../pages/ledger.html?admin=true" class="sidebar-link">
                    <span class="sidebar-icon">üìã</span>
                    <span class="sidebar-text">Ledger Overrides</span>
                    <span class="sidebar-badge" id="pendingOverrides">0</span>
                </a>
                <a href="../../pages/subscriptions.html?admin=true" class="sidebar-link">
                    <span class="sidebar-icon">üí≥</span>
                    <span class="sidebar-text">Subscription Management</span>
                    <span class="sidebar-badge" id="subscriptionIssues">0</span>
                </a>
                <a href="../../pages/groups.html?admin=true" class="sidebar-link">
                    <span class="sidebar-icon">üë•</span>
                    <span class="sidebar-text">Group Moderation</span>
                    <span class="sidebar-badge" id="pendingGroups">0</span>
                </a>
                <a href="../../pages/countries/index.html?admin=true" class="sidebar-link">
                    <span class="sidebar-icon">üåç</span>
                    <span class="sidebar-text">Country Management</span>
                </a>
                <a href="../../pages/debt-collectors.html?admin=true" class="sidebar-link">
                    <span class="sidebar-icon">üíº</span>
                    <span class="sidebar-text">Collector Verification</span>
                    <span class="sidebar-badge" id="pendingCollectors">0</span>
                </a>
                <div class="sidebar-divider"></div>
                <a href="../../pages/contact.html?admin=true" class="sidebar-link">
                    <span class="sidebar-icon">üìû</span>
                    <span class="sidebar-text">Support Tickets</span>
                    <span class="sidebar-badge" id="openTickets">0</span>
                </a>
                <a href="#" class="sidebar-link" id="systemSettingsBtn">
                    <span class="sidebar-icon">‚öôÔ∏è</span>
                    <span class="sidebar-text">System Settings</span>
                </a>
                <a href="#" class="sidebar-link" id="auditLogsBtn">
                    <span class="sidebar-icon">üìã</span>
                    <span class="sidebar-text">Audit Logs</span>
                </a>
                <a href="#" class="sidebar-link" id="reportsBtn">
                    <span class="sidebar-icon">üìà</span>
                    <span class="sidebar-text">Reports</span>
                </a>
            </nav>

            <div class="sidebar-footer">
                <div class="system-status">
                    <div class="status-icon">‚úÖ</div>
                    <div class="status-text">
                        <strong>System Status</strong>
                        <p id="systemStatus">All Systems Operational</p>
                    </div>
                </div>
                <button class="btn btn-outline btn-block" id="maintenanceModeBtn">
                    Maintenance Mode
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="dashboard-content">
            <!-- Admin Warning -->
            <div class="admin-warning">
                <div class="admin-warning-icon">‚ö†Ô∏è</div>
                <div>
                    <strong>ADMINISTRATOR ACCESS</strong>
                    <p>You have full platform override authority. All actions are logged and cannot be undone.</p>
                </div>
            </div>

            <!-- Quick Stats -->
            <section class="admin-stats-grid">
                <div class="admin-stat-card critical">
                    <div class="stat-card-header">
                        <div class="stat-card-icon">‚ö´</div>
                        <div class="stat-card-trend up">+5</div>
                    </div>
                    <div class="stat-card-content">
                        <div class="stat-card-value" id="blacklistedUsers">0</div>
                        <div class="stat-card-label">Blacklisted Users</div>
                        <div class="stat-card-subtext">Requiring review</div>
                    </div>
                </div>

                <div class="admin-stat-card warning">
                    <div class="stat-card-header">
                        <div class="stat-card-icon">üìã</div>
                        <div class="stat-card-trend up">+12</div>
                    </div>
                    <div class="stat-card-content">
                        <div class="stat-card-value" id="pendingApprovals">0</div>
                        <div class="stat-card-label">Pending Approvals</div>
                        <div class="stat-card-subtext">Ledgers & Ratings</div>
                    </div>
                </div>

                <div class="admin-stat-card success">
                    <div class="stat-card-header">
                        <div class="stat-card-icon">üí∞</div>
                        <div class="stat-card-trend up">+8.5%</div>
                    </div>
                    <div class="stat-card-content">
                        <div class="stat-card-value" id="platformRevenue">‚Çµ0</div>
                        <div class="stat-card-label">Platform Revenue</div>
                        <div class="stat-card-subtext">This month</div>
                    </div>
                </div>

                <div class="admin-stat-card info">
                    <div class="stat-card-header">
                        <div class="stat-card-icon">üë•</div>
                        <div class="stat-card-trend up">+3.2%</div>
                    </div>
                    <div class="stat-card-content">
                        <div class="stat-card-value" id="totalUsers">0</div>
                        <div class="stat-card-label">Total Users</div>
                        <div class="stat-card-subtext">Across all countries</div>
                    </div>
                </div>
            </section>

            <!-- Quick Actions -->
            <section class="quick-actions-section">
                <h2 class="section-title">Quick Actions</h2>
                <div class="admin-actions-grid">
                    <div class="admin-action-card" data-action="override-blacklist">
                        <div class="admin-action-icon">‚ö´</div>
                        <h4>Override Blacklist</h4>
                        <p>Remove or modify blacklist entries</p>
                    </div>

                    <div class="admin-action-card" data-action="adjust-rating">
                        <div class="admin-action-icon">‚≠ê</div>
                        <h4>Adjust Rating</h4>
                        <p>Manually adjust borrower ratings</p>
                    </div>

                    <div class="admin-action-card" data-action="edit-ledger">
                        <div class="admin-action-icon">üìã</div>
                        <h4>Edit Ledger</h4>
                        <p>Correct or update loan ledgers</p>
                    </div>

                    <div class="admin-action-card" data-action="verify-collector">
                        <div class="admin-action-icon">üíº</div>
                        <h4>Verify Collector</h4>
                        <p>Approve debt collector applications</p>
                    </div>

                    <div class="admin-action-card" data-action="moderate-group">
                        <div class="admin-action-icon">üë•</div>
                        <h4>Moderate Group</h4>
                        <p>Review and moderate group activities</p>
                    </div>

                    <div class="admin-action-card" data-action="resolve-dispute">
                        <div class="admin-action-icon">‚öñÔ∏è</div>
                        <h4>Resolve Dispute</h4>
                        <p>Mediate between lenders & borrowers</p>
                    </div>

                    <div class="admin-action-card" data-action="generate-report">
                        <div class="admin-action-icon">üìà</div>
                        <h4>Generate Report</h4>
                        <p>Create platform analytics report</p>
                    </div>

                    <div class="admin-action-card" data-action="system-backup">
                        <div class="admin-action-icon">üíæ</div>
                        <h4>System Backup</h4>
                        <p>Backup platform data</p>
                    </div>
                </div>
            </section>

            <!-- Recent Admin Actions -->
            <section class="recent-actions-section">
                <div class="section-header">
                    <h2 class="section-title">Recent Admin Actions</h2>
                    <button class="btn btn-text" id="refreshActionsBtn">Refresh</button>
                </div>

                <div class="admin-table-container">
                    <table class="admin-actions-table">
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Admin</th>
                                <th>Action</th>
                                <th>Target</th>
                                <th>Details</th>
                                <th>IP Address</th>
                            </tr>
                        </thead>
                        <tbody id="adminActionsTable">
                            <tr>
                                <td>2024-02-15 14:30</td>
                                <td>System Admin</td>
                                <td><span class="badge badge-warning">Rating Adjusted</span></td>
                                <td>John Doe (User#1234)</td>
                                <td>Rating changed from 3.2 to 4.0</td>
                                <td>192.168.1.1</td>
                            </tr>
                            <tr>
                                <td>2024-02-15 12:15</td>
                                <td>System Admin</td>
                                <td><span class="badge badge-success">Blacklist Removed</span></td>
                                <td>Sarah Mwangi (User#5678)</td>
                                <td>Full repayment confirmed, blacklist cleared</td>
                                <td>192.168.1.1</td>
                            </tr>
                            <tr>
                                <td>2024-02-14 16:45</td>
                                <td>System Admin</td>
                                <td><span class="badge badge-info">Ledger Corrected</span></td>
                                <td>Loan#L-001-2024</td>
                                <td>Interest calculation corrected</td>
                                <td>192.168.1.1</td>
                            </tr>
                            <tr>
                                <td>2024-02-14 11:20</td>
                                <td>System Admin</td>
                                <td><span class="badge badge-primary">Collector Verified</span></td>
                                <td>Debt Solutions Kenya</td>
                                <td>Documents verified, collector approved</td>
                                <td>192.168.1.1</td>
                            </tr>
                            <tr>
                                <td>2024-02-13 09:15</td>
                                <td>System Admin</td>
                                <td><span class="badge badge-danger">Group Suspended</span></td>
                                <td>Family Trust Group</td>
                                <td>Temporary suspension for rule violation</td>
                                <td>192.168.1.1</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- System Alerts -->
            <section class="alerts-section">
                <h2 class="section-title">System Alerts</h2>
                <div class="alerts-container">
                    <div class="alert-card alert-warning">
                        <div class="alert-icon">‚ö†Ô∏è</div>
                        <div class="alert-content">
                            <h4>Subscription Renewals Due</h4>
                            <p>15 lenders have subscriptions expiring in 3 days</p>
                            <div class="alert-actions">
                                <button class="btn btn-small btn-outline">Send Reminders</button>
                                <button class="btn btn-small btn-primary">View List</button>
                            </div>
                        </div>
                    </div>

                    <div class="alert-card alert-info">
                        <div class="alert-icon">‚ÑπÔ∏è</div>
                        <div class="alert-content">
                            <h4>System Update Available</h4>
                            <p>New platform version 2.1.0 is ready for deployment</p>
                            <div class="alert-actions">
                                <button class="btn btn-small btn-outline">Schedule Update</button>
                                <button class="btn btn-small btn-primary">View Changelog</button>
                            </div>
                        </div>
                    </div>

                    <div class="alert-card alert-success">
                        <div class="alert-icon">‚úÖ</div>
                        <div class="alert-content">
                            <h4>Backup Completed</h4>
                            <p>Daily system backup completed successfully at 02:00 AM</p>
                            <div class="alert-actions">
                                <button class="btn btn-small btn-outline">Verify Backup</button>
                                <button class="btn btn-small btn-primary">Download Logs</button>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Platform Metrics -->
            <section class="metrics-section">
                <div class="section-header">
                    <h2 class="section-title">Platform Metrics</h2>
                    <div class="time-selector">
                        <select id="metricsTimeframe" class="form-control form-control-sm">
                            <option value="7d">Last 7 Days</option>
                            <option value="30d" selected>Last 30 Days</option>
                            <option value="90d">Last 90 Days</option>
                            <option value="1y">Last Year</option>
                        </select>
                    </div>
                </div>

                <div class="metrics-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <h4>User Growth</h4>
                            <span class="metric-trend up">+12.5%</span>
                        </div>
                        <div class="metric-chart" id="userGrowthChart">
                            <!-- Chart would go here -->
                            <div class="chart-placeholder">üìà Chart: User Growth Over Time</div>
                        </div>
                        <div class="metric-stats">
                            <div class="stat">
                                <span class="stat-label">New Users</span>
                                <span class="stat-value">1,250</span>
                            </div>
                            <div class="stat">
                                <span class="stat-label">Active Users</span>
                                <span class="stat-value">8,500</span>
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <h4>Revenue Trend</h4>
                            <span class="metric-trend up">+8.3%</span>
                        </div>
                        <div class="metric-chart" id="revenueChart">
                            <div class="chart-placeholder">üí∞ Chart: Monthly Revenue</div>
                        </div>
                        <div class="metric-stats">
                            <div class="stat">
                                <span class="stat-label">This Month</span>
                                <span class="stat-value">‚Çµ85,000</span>
                            </div>
                            <div class="stat">
                                <span class="stat-label">Last Month</span>
                                <span class="stat-value">‚Çµ78,500</span>
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <h4>Repayment Rate</h4>
                            <span class="metric-trend up">+2.1%</span>
                        </div>
                        <div class="metric-chart" id="repaymentChart">
                            <div class="chart-placeholder">üìä Chart: Repayment Performance</div>
                        </div>
                        <div class="metric-stats">
                            <div class="stat">
                                <span class="stat-label">Current Rate</span>
                                <span class="stat-value">98.7%</span>
                            </div>
                            <div class="stat">
                                <span class="stat-label">Default Rate</span>
                                <span class="stat-value">1.3%</span>
                            </div>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <h4>Country Distribution</h4>
                            <span class="metric-trend neutral">¬±0%</span>
                        </div>
                        <div class="metric-chart" id="countryChart">
                            <div class="chart-placeholder">üåç Chart: Users by Country</div>
                        </div>
                        <div class="metric-stats">
                            <div class="stat">
                                <span class="stat-label">Top Country</span>
                                <span class="stat-value">Kenya (42%)</span>
                            </div>
                            <div class="stat">
                                <span class="stat-label">Fastest Growth</span>
                                <span class="stat-value">Ghana (+18%)</span>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Admin Override Modal -->
    <div class="modal" id="adminOverrideModal">
        <div class="modal-content" style="max-width: 700px;">
            <div class="modal-header">
                <h3 class="modal-title" id="overrideTitle">Admin Override</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <form id="adminOverrideForm">
                    <div class="form-group">
                        <label for="overrideAction">Override Action</label>
                        <select id="overrideAction" class="form-control" required>
                            <option value="">Select action type</option>
                            <option value="blacklist-remove">Remove from Blacklist</option>
                            <option value="rating-adjust">Adjust User Rating</option>
                            <option value="ledger-edit">Edit Loan Ledger</option>
                            <option value="subscription-extend">Extend Subscription</option>
                            <option value="group-suspend">Suspend/Activate Group</option>
                            <option value="user-ban">Ban/Unban User</option>
                            <option value="other">Other Administrative Action</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="overrideTarget">Target User/Entity</label>
                        <input type="text" id="overrideTarget" class="form-control" placeholder="User ID, Loan ID, or Group ID" required>
                    </div>

                    <div class="form-group">
                        <label for="overrideReason">Reason for Override</label>
                        <select id="overrideReason" class="form-control" required>
                            <option value="">Select reason</option>
                            <option value="error-correction">Error Correction</option>
                            <option value="dispute-resolution">Dispute Resolution</option>
                            <option value="fraud-prevention">Fraud Prevention</option>
                            <option value="system-error">System Error</option>
                            <option value="user-request">User Request (Verified)</option>
                            <option value="regulatory-compliance">Regulatory Compliance</option>
                            <option value="other">Other (Specify in notes)</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="overrideDetails">Action Details</label>
                        <textarea id="overrideDetails" class="form-control" rows="4" placeholder="Provide detailed explanation of what you are changing and why..." required></textarea>
                    </div>

                    <div class="form-group">
                        <label for="overrideEvidence">Evidence/Supporting Documents</label>
                        <input type="text" id="overrideEvidence" class="form-control" placeholder="Reference numbers, document IDs, or evidence description">
                        <div class="form-help">Optional: Provide evidence to support this override</div>
                    </div>

                    <div class="form-group">
                        <label for="overrideNotes">Internal Notes</label>
                        <textarea id="overrideNotes" class="form-control" rows="2" placeholder="Internal notes for audit trail..."></textarea>
                    </div>

                    <div class="override-warning">
                        <div class="warning-icon">‚ö†Ô∏è</div>
                        <div class="warning-content">
                            <strong>ADMINISTRATIVE OVERRIDE</strong>
                            <p>This action bypasses normal platform rules and will be permanently recorded in the audit trail. You are responsible for this action.</p>
                            <label class="checkbox-label">
                                <input type="checkbox" id="confirmOverride" required>
                                <span>I confirm that this override is necessary and justified</span>
                            </label>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-primary">
                            <span class="btn-icon">‚ö°</span>
                            Execute Override
                        </button>
                        <button type="button" class="btn btn-outline close-modal">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- System Logs Panel -->
    <div class="modal" id="systemLogsModal">
        <div class="modal-content" style="max-width: 900px;">
            <div class="modal-header">
                <h3 class="modal-title">System Logs</h3>
                <button class="modal-close">&times;</button>
            </div>
            <div class="modal-body">
                <div class="logs-controls">
                    <div class="form-group">
                        <label for="logLevel">Log Level</label>
                        <select id="logLevel" class="form-control">
                            <option value="all">All Levels</option>
                            <option value="error">Errors Only</option>
                            <option value="warning">Warnings & Errors</option>
                            <option value="info">Info, Warnings & Errors</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="logDate">Date Range</label>
                        <input type="date" id="logDate" class="form-control" value="2024-02-15">
                    </div>
                    <button class="btn btn-primary" id="refreshLogsBtn">Refresh</button>
                    <button class="btn btn-outline" id="exportLogsBtn">Export Logs</button>
                </div>

                <div class="logs-container">
                    <div class="log-entry error">
                        <span class="log-timestamp">2024-02-15 14:30:25</span>
                        <span class="log-level">ERROR</span>
                        <span class="log-message">Failed to process subscription payment for user#1234</span>
                    </div>
                    <div class="log-entry warning">
                        <span class="log-timestamp">2024-02-15 14:25:10</span>
                        <span class="log-level">WARNING</span>
                        <span class="log-message">High number of failed login attempts from IP: 192.168.1.100</span>
                    </div>
                    <div class="log-entry info">
                        <span class="log-timestamp">2024-02-15 14:20:05</span>
                        <span class="log-level">INFO</span>
                        <span class="log-message">Daily backup completed successfully</span>
                    </div>
                    <div class="log-entry info">
                        <span class="log-timestamp">2024-02-15 14:15:30</span>
                        <span class="log-level">INFO</span>
                        <span class="log-message">User registration: Sarah Mwangi (user#5678)</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="../../assets/js/utils.js"></script>
    <script src="../../assets/js/auth.js"></script>
    <script>
        // Admin Dashboard specific functionality
        document.addEventListener('DOMContentLoaded', function() {
            // Check if user is logged in and is an admin
            const user = window.utils.getCurrentUser();
            if (!user || user.role !== 'admin') {
                window.showToast('Administrative access required', 'error');
                setTimeout(() => {
                    window.location.href = '../../index.html';
                }, 1500);
                return;
            }

            // Setup event listeners
            document.getElementById('logoutBtn').addEventListener('click', function() {
                window.utils.clearCurrentUser();
                window.showToast('Logged out from admin dashboard', 'success');
                setTimeout(() => {
                    window.location.href = '../../index.html';
                }, 1000);
            });

            document.getElementById('systemLogsBtn').addEventListener('click', function() {
                document.getElementById('systemLogsModal').classList.add('active');
                document.body.style.overflow = 'hidden';
            });

            document.getElementById('auditTrailBtn').addEventListener('click', function() {
                window.showToast('Audit trail viewer coming soon', 'info');
            });

            document.getElementById('maintenanceBtn').addEventListener('click', function() {
                toggleMaintenanceMode();
            });

            document.getElementById('maintenanceModeBtn').addEventListener('click', function() {
                toggleMaintenanceMode();
            });

            document.getElementById('refreshActionsBtn').addEventListener('click', function() {
                loadRecentActions();
            });

            // Quick action cards
            document.querySelectorAll('.admin-action-card').forEach(card => {
                card.addEventListener('click', function() {
                    const action = this.dataset.action;
                    handleAdminAction(action);
                });
            });

            // Close modals
            document.querySelectorAll('.modal-close, .close-modal').forEach(btn => {
                btn.addEventListener('click', function() {
                    this.closest('.modal').classList.remove('active');
                    document.body.style.overflow = '';
                });
            });

            document.querySelectorAll('.modal').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        this.classList.remove('active');
                        document.body.style.overflow = '';
                    }
                });
            });

            // Admin override form
            document.getElementById('adminOverrideForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                const action = document.getElementById('overrideAction').value;
                const target = document.getElementById('overrideTarget').value;
                const reason = document.getElementById('overrideReason').value;
                const details = document.getElementById('overrideDetails').value;
                
                if (!action || !target || !reason || !details) {
                    window.showToast('Please fill in all required fields', 'error');
                    return;
                }

                if (!document.getElementById('confirmOverride').checked) {
                    window.showToast('Please confirm the override', 'error');
                    return;
                }

                // Simulate override execution
                window.showToast(`Admin override executed: ${action} on ${target}`, 'success');
                
                // Log the action
                logAdminAction({
                    action: action,
                    target: target,
                    reason: reason,
                    details: details,
                    admin: user.fullName || 'System Admin',
                    timestamp: new Date().toISOString()
                });

                // Close modal
                document.getElementById('adminOverrideModal').classList.remove('active');
                document.body.style.overflow = '';

                // Reset form
                this.reset();
            });

            // Load initial data
            loadAdminStats();
            loadRecentActions();

            // Mobile menu toggle
            document.getElementById('mobileMenuBtn').addEventListener('click', function() {
                document.getElementById('mobileMenu').classList.add('active');
            });

            document.getElementById('closeMenuBtn').addEventListener('click', function() {
                document.getElementById('mobileMenu').classList.remove('active');
            });

            // Sidebar actions
            document.getElementById('systemSettingsBtn').addEventListener('click', function(e) {
                e.preventDefault();
                window.showToast('System settings panel coming soon', 'info');
            });

            document.getElementById('auditLogsBtn').addEventListener('click', function(e) {
                e.preventDefault();
                document.getElementById('systemLogsModal').classList.add('active');
                document.body.style.overflow = 'hidden';
            });

            document.getElementById('reportsBtn').addEventListener('click', function(e) {
                e.preventDefault();
                window.showToast('Report generation coming soon', 'info');
            });
        });

        function loadAdminStats() {
            // Simulate loading admin statistics
            setTimeout(() => {
                document.getElementById('blacklistedUsers').textContent = '15';
                document.getElementById('pendingApprovals').textContent = '23';
                document.getElementById('platformRevenue').textContent = '‚Çµ85,250';
                document.getElementById('totalUsers').textContent = '12,850';
                
                document.getElementById('pendingBlacklist').textContent = '5';
                document.getElementById('pendingOverrides').textContent = '12';
                document.getElementById('subscriptionIssues').textContent = '8';
                document.getElementById('pendingGroups').textContent = '3';
                document.getElementById('pendingCollectors').textContent = '7';
                document.getElementById('openTickets').textContent = '18';
            }, 500);
        }

        function loadRecentActions() {
            // This would normally fetch from an API
            window.showToast('Recent actions refreshed', 'success');
        }

        function handleAdminAction(action) {
            const actions = {
                'override-blacklist': {
                    title: 'Override Blacklist',
                    description: 'Remove or modify blacklist entries'
                },
                'adjust-rating': {
                    title: 'Adjust User Rating',
                    description: 'Manually adjust borrower ratings'
                },
                'edit-ledger': {
                    title: 'Edit Loan Ledger',
                    description: 'Correct or update loan ledgers'
                },
                'verify-collector': {
                    title: 'Verify Debt Collector',
                    description: 'Approve collector applications'
                },
                'moderate-group': {
                    title: 'Moderate Group',
                    description: 'Review group activities'
                },
                'resolve-dispute': {
                    title: 'Resolve Dispute',
                    description: 'Mediate between parties'
                },
                'generate-report': {
                    title: 'Generate Report',
                    description: 'Create analytics report'
                },
                'system-backup': {
                    title: 'System Backup',
                    description: 'Backup platform data'
                }
            };

            const actionInfo = actions[action];
            if (!actionInfo) return;

            // For now, open the override modal for most actions
            if (action !== 'generate-report' && action !== 'system-backup') {
                document.getElementById('overrideTitle').textContent = actionInfo.title;
                document.getElementById('adminOverrideModal').classList.add('active');
                document.body.style.overflow = 'hidden';
                
                // Pre-fill the action type if it matches
                const actionMap = {
                    'override-blacklist': 'blacklist-remove',
                    'adjust-rating': 'rating-adjust',
                    'edit-ledger': 'ledger-edit',
                    'verify-collector': 'other',
                    'moderate-group': 'group-suspend',
                    'resolve-dispute': 'other'
                };
                
                if (actionMap[action]) {
                    document.getElementById('overrideAction').value = actionMap[action];
                }
            } else {
                window.showToast(`${actionInfo.title} functionality coming soon`, 'info');
            }
        }

        function logAdminAction(data) {
            // Simulate logging to localStorage
            const logs = JSON.parse(localStorage.getItem('admin-actions') || '[]');
            logs.unshift({
                ...data,
                id: 'action-' + Date.now(),
                ip: '192.168.1.1' // Mock IP
            });
            
            // Keep only last 100 logs
            if (logs.length > 100) {
                logs.length = 100;
            }
            
            localStorage.setItem('admin-actions', JSON.stringify(logs));
            
            // Update the table
            updateActionsTable(logs);
        }

        function updateActionsTable(logs) {
            const table = document.getElementById('adminActionsTable');
            if (!table) return;

            // Clear existing rows (except the first 5 demo rows)
            while (table.rows.length > 5) {
                table.deleteRow(5);
            }

            // Add new log entries
            logs.slice(0, 5).forEach(log => {
                const row = table.insertRow();
                
                // Format timestamp
                const date = new Date(log.timestamp);
                const timestamp = date.toLocaleDateString('en-CA') + ' ' + 
                                 date.toLocaleTimeString('en-US', {hour12: false}).slice(0, 5);
                
                // Determine badge type
                let badgeClass = 'badge-info';
                if (log.action.includes('blacklist')) badgeClass = 'badge-success';
                if (log.action.includes('suspend') || log.action.includes('ban')) badgeClass = 'badge-danger';
                if (log.action.includes('rating')) badgeClass = 'badge-warning';
                
                row.innerHTML = `
                    <td>${timestamp}</td>
                    <td>${log.admin}</td>
                    <td><span class="badge ${badgeClass}">${log.action.replace('-', ' ').toUpperCase()}</span></td>
                    <td>${log.target}</td>
                    <td>${log.details.substring(0, 50)}${log.details.length > 50 ? '...' : ''}</td>
                    <td>${log.ip}</td>
                `;
            });
        }

        function toggleMaintenanceMode() {
            const isMaintenance = localStorage.getItem('maintenance-mode') === 'true';
            
            if (!isMaintenance) {
                if (confirm('Enable maintenance mode? This will restrict access for regular users.')) {
                    localStorage.setItem('maintenance-mode', 'true');
                    window.showToast('Maintenance mode enabled', 'warning');
                    document.getElementById('systemStatus').textContent = 'Maintenance Mode';
                    document.getElementById('systemStatus').style.color = '#FF9F1C';
                }
            } else {
                if (confirm('Disable maintenance mode?')) {
                    localStorage.setItem('maintenance-mode', 'false');
                    window.showToast('Maintenance mode disabled', 'success');
                    document.getElementById('systemStatus').textContent = 'All Systems Operational';
                    document.getElementById('systemStatus').style.color = '';
                }
            }
        }

        // Check maintenance mode on load
        if (localStorage.getItem('maintenance-mode') === 'true') {
            document.getElementById('systemStatus').textContent = 'Maintenance Mode';
            document.getElementById('systemStatus').style.color = '#FF9F1C';
        }
    </script>
</body>
</html>